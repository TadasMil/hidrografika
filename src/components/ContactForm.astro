---
// Contact form - frontend only
import { siteConfig } from "../data/site";

const emailTo = siteConfig.email;

// Defaults (optional)
const defaultSubject = "Užklausa dėl hidrografikos";
---

<section class="py-16 bg-gray-900">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8">
    <div class="max-w-2xl mx-auto">
      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">
          Gauti Pasiūlymą
        </h2>
        <p class="text-xl text-gray-400">
          Užpildykite žemiau esantį formą ir atsiliepsime per 24 valandas
        </p>
      </div>

      <form
        id="contact-form"
        method="post"
        class="space-y-6 bg-gray-800 p-8 rounded-lg border border-gray-700"
      >
        <!-- Name -->
        <div>
          <label
            for="name"
            class="block text-sm font-medium text-gray-300 mb-2"
          >
            Pilnas Vardas <span class="text-red-500">*</span>
          </label>
          <input
            type="text"
            id="name"
            name="name"
            required
            class="w-full px-4 py-3 bg-gray-900 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all"
            placeholder="Jonas Jonaitis"
          />
        </div>

        <!-- Email -->
        <div>
          <label
            for="email"
            class="block text-sm font-medium text-gray-300 mb-2"
          >
            El. Pašto Adresas <span class="text-red-500">*</span>
          </label>
          <input
            type="email"
            id="email"
            name="email"
            required
            class="w-full px-4 py-3 bg-gray-900 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all"
            placeholder="jonas@pavyzdys.com"
          />
        </div>

        <!-- Phone -->
        <div>
          <label
            for="phone"
            class="block text-sm font-medium text-gray-300 mb-2"
          >
            Telefono Numeris <span class="text-red-500">*</span>
          </label>
          <input
            type="tel"
            id="phone"
            name="phone"
            required
            class="w-full px-4 py-3 bg-gray-900 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all"
            placeholder="+370 600 12345"
          />
        </div>

        <!-- Item Type -->
        <div>
          <label
            for="item-type"
            class="block text-sm font-medium text-gray-300 mb-2"
          >
            Daikto Tipas <span class="text-red-500">*</span>
          </label>
          <select
            id="item-type"
            name="item-type"
            required
            class="w-full px-4 py-3 bg-gray-900 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all"
          >
            <option value="">Pasirinkite variɏtą</option>
            <option value="automotive">Automobilių Dalys</option>
            <option value="firearms">Ginklai ir Taktinė Įranga</option>
            <option value="sporting">Sportinės Prekės</option>
            <option value="industrial">Pramonės ir Individualūs</option>
            <option value="other">Kitas</option>
          </select>
        </div>

        <!-- Message -->
        <div>
          <label
            for="message"
            class="block text-sm font-medium text-gray-300 mb-2"
          >
            Projekto Detalės <span class="text-red-500">*</span>
          </label>
          <textarea
            id="message"
            name="message"
            rows="5"
            required
            class="w-full px-4 py-3 bg-gray-900 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all resize-none"
            placeholder="Prašome aprašyti savo projektą, įskaitant daikto matmenis, pageidaujamą raštą ir specialius reikalavimus..."
          ></textarea>
        </div>

        <!-- Preferred Contact Method -->
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-3">
            Pageidaujamas Bendravimo Būdas
          </label>
          <div class="flex flex-wrap gap-4">
            <label class="flex items-center cursor-pointer">
              <input
                type="radio"
                name="contact-method"
                value="email"
                checked
                class="w-4 h-4 text-cyan-500 bg-gray-900 border-gray-700 focus:ring-cyan-500 focus:ring-2"
              />
              <span class="ml-2 text-gray-300">El. paštas</span>
            </label>
            <label class="flex items-center cursor-pointer">
              <input
                type="radio"
                name="contact-method"
                value="phone"
                class="w-4 h-4 text-cyan-500 bg-gray-900 border-gray-700 focus:ring-cyan-500 focus:ring-2"
              />
              <span class="ml-2 text-gray-300">Telefonas</span>
            </label>
            <label class="flex items-center cursor-pointer">
              <input
                type="radio"
                name="contact-method"
                value="either"
                class="w-4 h-4 text-cyan-500 bg-gray-900 border-gray-700 focus:ring-cyan-500 focus:ring-2"
              />
              <span class="ml-2 text-gray-300">Bet kuris</span>
            </label>
          </div>
        </div>

        <!-- Submit Button -->
        <div>
          <button
            type="submit"
            class="w-full px-8 py-4 bg-cyan-500 text-white font-semibold rounded-lg hover:bg-cyan-600 transition-all shadow-lg shadow-cyan-500/30 hover:shadow-cyan-500/50 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:ring-offset-2 focus:ring-offset-gray-800"
          >
            Siųsti Žinutę
          </button>
        </div>

        <!-- Privacy Note -->
        <p class="text-xs text-gray-500 text-center">
          Pateikdami šį formą, sutinkate su mūsų <a
            href="/privacy"
            class="text-cyan-400 hover:text-cyan-300 underline"
            >Privatumo Politika</a
          > ir <a
            href="/terms"
            class="text-cyan-400 hover:text-cyan-300 underline"
            >Paslaugos Sąlygomis</a
          >.
        </p>
      </form>
    </div>
  </div>
</section>

<script
  define:vars={{
    emailTo: siteConfig.email,
    defaultSubject: "Užklausa dėl hidrografikos",
  }}
>
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("contact-form");
    if (!form) return;

    form.addEventListener("submit", (e) => {
      e.preventDefault();

      // Native validation messages
      if (typeof form.reportValidity === "function" && !form.reportValidity())
        return;

      const fd = new FormData(form);

      const name = String(fd.get("name") || "").trim();
      const fromEmail = String(fd.get("email") || "").trim();
      const phone = String(fd.get("phone") || "").trim();
      const itemType = String(fd.get("item-type") || "").trim();
      const message = String(fd.get("message") || "").trim();
      const contactMethod = String(fd.get("contact-method") || "email").trim();

      const itemTypeLabel =
        itemType === "automotive"
          ? "Automobilių Dalys"
          : itemType === "firearms"
            ? "Ginklai ir Taktinė Įranga"
            : itemType === "sporting"
              ? "Sportinės Prekės"
              : itemType === "industrial"
                ? "Pramonės ir Individualūs"
                : itemType === "other"
                  ? "Kitas"
                  : itemType || "—";

      const subject = `${defaultSubject} – ${itemTypeLabel}`;

      const body = [
        "Sveiki,",
        "",
        "Nauja užklausa iš kontaktų formos:",
        "",
        `Vardas: ${name}`,
        `El. paštas: ${fromEmail}`,
        `Telefonas: ${phone}`,
        `Daikto tipas: ${itemTypeLabel}`,
        `Pageidaujamas bendravimas: ${contactMethod}`,
        "",
        "Projekto detalės:",
        message,
        "",
      ].join("\n");

      const gmailUrl =
        "https://mail.google.com/mail/?view=cm&fs=1" +
        `&to=${encodeURIComponent(emailTo)}` +
        `&su=${encodeURIComponent(subject)}` +
        `&body=${encodeURIComponent(body)}`;

      const mailtoUrl =
        `mailto:${emailTo}` +
        `?subject=${encodeURIComponent(subject)}` +
        `&body=${encodeURIComponent(body)}`;

      // Try Gmail first; fallback to mailto if popup blocked
      const win = window.open(gmailUrl, "_blank", "noopener,noreferrer");
      if (!win) window.location.href = mailtoUrl;

      // Optional: redirect after launching (usually NOT needed)
      // window.location.href = "/thanks";
    });
  });
</script>
